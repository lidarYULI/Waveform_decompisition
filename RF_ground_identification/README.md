Here is the introduction of ground return mode identification process based on GEDI waveform

The ground return mode location is important because it corresponds to elevation and impact return energy estimation

I developed a method based on Random Forest (RF) Classifier to identify ground return mode, then I recalculated canopy cover based on it. This method has been tested in six NEON forest sites

Mode is the first derivative of the waveform; 19 features of modes from three aspects are calculated and used in RF;

![result](https://github.com/lidarYULI/Waveform_decompisition/blob/master/result_output/Features_definition.png)

![result](https://github.com/lidarYULI/Waveform_decompisition/blob/master/result_output/Waveform_RF.png)

Three steps in my work:
(1) training samples generation

Training samples can be generated from two ways: the first is visual selection from waveform based on reference ALS elevation and canopy cover;
Run RF_ground_identification/derivation_samples.py/trainsamples_by_manual_selection() to generate samples;
the samples will be saved to result_output/training_visualsamples

the second is to directly determine the ground return mode by ALS elevation; This means a mode location is taken as the ground return if it is most close to ALS elevation
Run RF_ground_identification/derivation_samples.py/trainsamples_by_ALS_elevation() to generate samples;
the samples will be saved to result_output/training_ALSsamples

(2) RF training and prediction

to train RF based on one of samples collections generated by last steps:

Run  RF_ground_identification/derivation_samples.py/train_by_manual_samples() or train_by_elevation_samples()

the trained models are saved in result_output/training_visualsamples() or training_ALSsamples()


to predict: run code in RF_ground_identification/derivation_samples.py

RF_excel = file_path.RF_excel # take all GEDI records (7_RF_comparison.xlsx) from research sites for prediction

model_folder = file_path.elevation_train # designate a work space that includes training samples and trained RF models

RF_predict_bysite(RF_excel, model_folder);

A column "randomforest_zcross", identified ground return location (bins) will be added to the excel (7_RF_comparison.xlsx);

(3) canopy cover recalculation

use product_derive.py to calculate canopy cover

RF_excel = file_path.RF_excel

decompose_based_selected_zcross(RF_excel,'randomforest_zcross')

in this process, ground return mode is fitted by gaussian function or extended gaussian function to separate the canopy waveform and ground waveform

the identified ground return mode location and corresponding amplitude are used in fitting;

the boundary sets for gaussian fitting are important in subsequent product estimation

Three columns will be added if using gaussian fit

'RV_RF_z': cumulative canopy return energy at different heights

'CC_RF_z': cumulative canopy cover at different heights;

'Fitted_parameters_Rg_RF_GAU': ground mode fitting parameters: amplitude, center, and sigma 


